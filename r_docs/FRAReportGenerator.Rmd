---
title: "FR+A Report Generator"
output: 
  word_document:
    reference_docx: data/fra-template.docx
date: "2023-12-30"
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
datapath <- "data/"
imgpath <- "images/"
knitr::opts_chunk$set(echo = FALSE)
library(magrittr)
library(officer)
library(officedown)
library(dplyr)
library(toOrdinal)
source("r_docs/R/styles_variables_functions.R")
source("r_docs/R/footnotes.R")
source("r_docs/R/intro_parts.R")
source("r_docs/R/background_facts_med_hx.R")
source("r_docs/R/general_comments.R")
source("r_docs/R/inj_biomech.R")
source("r_docs/R/signature_block_appendix.R")
# table for reading styles
styles_tab <- styles_info(doc)
```

```{r loop fpar add function}
block_add_fps_fun <- function(x, list) {
  for (i in length(list):1) {
    for (j in length(list[[i]]):1) {
      body_add(x, list[[i]][[j]], style = list[[i]][[j]]$style)
    }
  }
  return(x)
}
```

```{r test full doc build code}

default_placeholder <- list(
  fps(
    ftext(
      "Placeholder text"
    )
  )
)

# build injury biomechanics section
# causation
if (doc_type == "causation") {
  if (crash$pdof == "rear") {
    # rear disk
    if (plaintiff$injury_location == "disk") {
      injury_biomechanics_build <- list(
        inj_biomech$intro$causation,
        inj_biomech$meat$caus$rear$disk)
      # rear shoulder
    } else if (plaintiff$injury_location == "shoulder") {
      injury_biomechanics_build <- list(
        inj_biomech$intro$causation,
        inj_biomech$meat$caus$rear$shoulder)
    }
  } else if (crash$pdof == "frontal") {
    # frontal disk
    if (plaintiff$injury_location == "disk") {
      injury_biomechanics_build <- list(
        inj_biomech$intro$causation,
        inj_biomech$meat$caus$frontal$disk)
      # frontal shoulder
    } else if (plaintiff$injury_location == "shoulder") {
      injury_biomechanics_build <- list(
        inj_biomech$intro$causation,
        inj_biomech$meat$caus$frontal$shoulder)
    }
  } else {
    injury_biomechanics_build <- list(
      default_placeholder
    )
  }
  # rebuttal
} else if (doc_type == "rebuttal") {
  if (defense_biomech_expert$firm == "BRC") {
    injury_biomechanics_build <- list(
      inj_biomech$meat$rebuttal$BRC
    )
  } else {
    injury_biomechanics_build <- list(
      inj_biomech$meat$rebuttal$all_experts
    )
  }
  # all other situations
} else {
  injury_biomechanics_build <- list(
    default_placeholder
  )
}


notes_doc_build <- list(
  heading, 
  background_facts$notes)



caus_doc_rear_disk_build <- list(
  heading,
  qualifications$causation,
  background_facts$causation,
  inj_biomech$meat$caus$rear$disk
)

# current job: make new entries for invisible footnote text and make invisible style in word template
caus_doc_rear_shoulder_build <- list(
  heading, 
  background_facts$causation,
  inj_biomech$meat$caus$rear$shoulder
)

caus_doc_near_side_disk_build <- list(
  heading,
  receipt,
  purpose$causation$general,
  qualifications$causation, 
  background_facts$causation,
  inj_biomech$intro$causation,
  inj_biomech$meat$caus$near_side$disk,
  three_steps$causation$disk,
  signature_block
)

caus_doc_near_side_shoulder_build <- list(
  heading, 
  background_facts$causation,
  inj_biomech$meat$caus$near_side$shoulder,
  inj_biomech$meat$caus$rear$shoulder
)

rebut_doc_build <- list(
  heading, 
  background_facts$rebuttal,
  inj_biomech$meat$rebuttal,
  three_steps$rebuttal$all_experts,
  signature_block
)

rebut_short_doc_build <- list(
  heading, 
  qualifications$rebuttal_short,
  background_facts$rebuttal,
  inj_biomech$meat$rebuttal,
  three_steps$rebuttal$all_experts,
  signature_block
)


caus_doc_build <- list(
  heading,
  receipt,
  purpose$causation$general,
  qualifications$causation,
  background_facts$causation,
  signature_block,
  appendix$causation$general
)
```

```{r function call}
#fps function call
doc %>%
  cursor_begin() %>%
  body_remove() %>%
  block_add_fps_fun(injury_biomechanics_build) %>%
  #body_add(fpar(run_wordtext("Here's the thing that will be invisible!"))) %>%
  print(target = "FRA-report-output.docx")

```

```{r final build}
# Heading

# Lawyer address

# Intro paragraph

# The Purpose of this Report

# Summary Opinions (rebuttal)

# Qualifications

# Background Facts

# Medical History

# General Comments on Expert (rebuttal)

# Injury Biomechanics intro

# Injury Biomechanics body

# 3 steps alternative explanations (Causation)

# Rebuttal points

# Conclusions

# Signature Block

# Appendix

```

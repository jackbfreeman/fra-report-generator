---
title: "FR+A Report Generator"
output: 
  word_document:
    reference_docx: data/fra-template.docx
date: "2023-12-30"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(magrittr)
library(officer)
library(dplyr)
source("../r_docs/R/grammar.R")
source("../r_docs/R/styles.R")
source("../r_docs/R/variables.R")
source("../r_docs/R/elements/heading.R")
source("../r_docs/R/elements/qualifications.R")
source("../r_docs/R/elements/receipt.R")
# table for reading styles
styles_tab <- styles_info(doc)
```

```{r header}
# create block list for header
header_blocklist <- block_list(
  headers_replace_all_text(x = doc, old_value = "Line1", new_value = paste0(lawyer$first_name, " ", lawyer$last_name, ", Esquire"), warn = FALSE),
  headers_replace_all_text(x = doc, old_value = "Line2", new_value = "Attorney at Law", warn = FALSE),
  headers_replace_all_text(x = doc, old_value = "Line3", new_value = case_name, warn = FALSE),
  headers_replace_all_text(x = doc, old_value = "ddd_date", new_value = convert_date_format(ddd), warn = FALSE)
)
```

```{r paragraph style definitions}
# word_style "Compact" is footnote style (size 9, single space)
fp_par_footnote <- fp_par(line_spacing = 1, word_style = "Compact")

```


```{r text style definitions}
# superscript footnote reference style
fp_text_refnote <- fp_text_lite(vertical.align = "superscript")
fp_text_italic <- fp_text_lite(italic = TRUE)

```

```{r qualifications}
# choose appropriate blocklists for case type
heading_blocklist <- if(doc_type == "notes") {
  heading_blocklist_notes
} else {
  heading_blocklist_caus_etc
}

qualifications_blocklist <- if(doc_type == "notes") {
  block_list()
  } else {
  qualifications_blocklist_causation
}
```

```{r sample footnote}
# working footnote structure
bl <- block_list(
  fpar(ftext(" hello"), fp_p = fp_par_footnote), 
  fpar(ftext(" second ref"), fp_p = fp_par_footnote),
  fpar(ftext(" second ref"), fp_p = fp_par_footnote)
)

footnote_fpar <- fpar(
  "this paragraph contains a note",
  run_footnote(x = bl[1], prop = fp_text_refnote),
  run_footnote(x = bl[2], prop = fp_text_refnote),
  run_footnote(x = bl[3], prop = fp_text_refnote),
  "."
)
```

```{r final build}
# fonts: use Normal for 16pt spacing and Body Text 2 for single line spacing
doc %>%
body_add(heading_blocklist) %>%
body_add(qualifications_blocklist) %>%
print(target = "../FRA-report-output.docx")

# Header

# Lawyer address

# Intro paragraph

# The Purpose of this Report

# Summary Opinions (rebuttal)

# Qualifications

# Background Facts

# Medical History

# General Comments on Expert (rebuttal)

# Injury Biomechanics intro

# Injury Biomechanics body

# 3 steps alternative explanations (Causation)

# Rebuttal points

# Conclusions

# Signature Block

# Appendix

```